<html>
  <head>
    <meta charset="UTF-8" />
    <title>Histogramme Températures</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load("current", { packages: ["corechart"] });
      google.charts.setOnLoadCallback(fetchData);

      function fetchData() {
        fetch('/tawarano/')
          .then(response => response.json())
          .then(data => drawChart(data));
      }

      function drawChart(data) {
        var dataTable = new google.visualization.DataTable();
        dataTable.addColumn('string', 'Date');
        dataTable.addColumn('number', 'Température (°C)');

        data.list.forEach(entry => {
          const date = entry.dt_txt;
          const tempCelsius = (entry.main.temp - 273.15).toFixed(2); // Conversion Kelvin -> °C
          dataTable.addRow([date, parseFloat(tempCelsius)]);
        });

        const options = {
          title: "Histogramme des températures (°C) - Ville de Tawarano",
          legend: { position: "none" },
          colors: ["#3366cc"],
          hAxis: {
            title: "Date/Heure",
            slantedText: true,
            slantedTextAngle: 45,
            showTextEvery: 4
          },
          vAxis: {
            title: "Température (°C)"
          }
        };

        const chart = new google.visualization.Histogram(document.getElementById("chart_div"));
        chart.draw(dataTable, options);
      }
    </script>
  </head>
  <body>
    <div id="chart_div" style="width: 1000px; height: 500px;"></div>
  </body>
</html>
